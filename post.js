function getPostId(){var t=window.location.search,e={};"?"===t.charAt(0)&&(t=t.substring(1));for(var o=t.split("&"),n=0;n<o.length;n++){var r=o[n].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]||"")}return e.id}function loadPost(){const t=getPostId();t?fetch(`${root_url}/api/posts/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()})).then((t=>displayPost(t))).catch((t=>{console.error("Error:",t),displayError("Error loading post: "+t.message)})):window.location.href="/blog.html"}function displayPost(t){if(t&&t.title&&t.content){if(document.title=t.title+" - Blog Post",document.getElementById("postTitle").textContent=t.title,document.getElementById("postContent").innerHTML=t.content,"undefined"!=typeof Prism)document.querySelectorAll("pre code").forEach((function(t){Prism.highlightElement(t)}));document.getElementById("postMeta").innerHTML="Posted: "+formatDateTime(t.created)+(t.modified&&t.modified!==t.created?"<br>Last Modified: "+formatDateTime(t.modified):""),fetch(`${root_url}/api/check-auth`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then((t=>t.json())).then((t=>{t.isAuthenticated&&(document.getElementById("postControls").style.display="flex")})).catch((t=>console.error("Auth check error:",t)))}else displayError("Invalid post data")}function checkAuthStatus(){fetch(`${root_url}/api/check-auth`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then((t=>t.json())).then((t=>{const e=document.getElementById("postControls");!0===t.isAuthenticated&&e&&(e.style.display="flex")})).catch((t=>console.error("Auth check error:",t)))}function formatDateTime(t){var e=new Date(t);return e.toLocaleDateString()+" "+e.toLocaleTimeString()}function editPost(){var t=getPostId();window.location.href="/blog.html?action=edit&id="+t}function deletePost(){const t=getPostId();confirm("Are you sure you want to delete this post?")&&fetch(`${root_url}/api/posts/${t}`,{method:"DELETE",credentials:"include"}).then((t=>{if(!t.ok)throw new Error("Delete failed");window.location.href="/blog.html"})).catch((t=>{console.error("Error:",t),alert("Delete failed: "+t.message)}))}function displayError(t){document.title="Error - Blog Post",document.getElementById("postTitle").textContent="Error",document.getElementById("postContent").textContent=t,document.getElementById("postMeta").textContent="";var e=document.getElementById("postControls");e&&(e.style.display="none")}function logout(){fetch(`${root_url}/api/logout`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((t=>{document.cookie.split(";").forEach((function(t){document.cookie=t.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")})),window.location.href="/"})).catch((t=>{console.error("Logout error:",t),window.location.href="/"}))}window.onload=function(){checkAuthStatus(),loadPost()};
