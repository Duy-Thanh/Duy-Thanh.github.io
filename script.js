function getQueryParam(e){var t=window.location.search,n={};"?"===t.charAt(0)&&(t=t.substring(1));for(var o=t.split("&"),a=0;a<o.length;a++){var r=o[a].split("=");n[decodeURIComponent(r[0])]=decodeURIComponent(r[1]||"")}return n[e]}function continueAsGuest(){document.cookie.split(";").forEach((function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")}));var e=new XMLHttpRequest;e.open("POST",root_url+"/api/guest",!0),e.withCredentials=!0,e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){getQueryParam("redirect");window.location.replace("/files.html")}},e.send(JSON.stringify({}))}function handleLogin(){var e=document.getElementById("username").value.trim(),t=document.getElementById("password").value.trim(),n=document.getElementById("message"),o=new XMLHttpRequest;o.open("POST",root_url+"/api/login",!0),o.withCredentials=!0,o.setRequestHeader("Content-Type","application/json"),o.onreadystatechange=function(){if(4===o.readyState)try{var e=JSON.parse(o.responseText);e.success?(n.style.color="green",n.textContent="Login successful!",setTimeout((function(){var e=getQueryParam("redirect");window.location.href="files"===e?"/files.html":"blog"===e?"/blog.html":"/files.html"}),300)):n.textContent=e.message||"Login failed"}catch(e){n.textContent="An error occurred. Please try again."}},o.send(JSON.stringify({username:e,password:t}))}window.onload=function(){var e=document.getElementById("loginForm"),t=document.querySelector(".guest-access"),n=document.getElementById("loginMessage"),o=document.getElementById("guestMessage");"blog"===getQueryParam("redirect")&&(t&&(t.style.display="none"),o&&(o.style.display="none"),n&&(n.textContent="You need to log in to manage blog posts")),e&&(e.onsubmit=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,handleLogin()})};
