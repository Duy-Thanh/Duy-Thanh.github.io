function getQueryParam(e){var t=window.location.search,n={};"?"===t.charAt(0)&&(t=t.substring(1));for(var o=t.split("&"),r=0;r<o.length;r++){var s=o[r].split("=");n[decodeURIComponent(s[0])]=decodeURIComponent(s[1]||"")}return n[e]}function continueAsGuest(){document.cookie.split(";").forEach((function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")})),fetch(`${root_url}/api/guest`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{if(e.success){getQueryParam("redirect");window.location.replace("/files.html")}})).catch((e=>console.error("Guest login error:",e)))}function handleLogin(){var e=document.getElementById("username").value.trim(),t=document.getElementById("password").value.trim(),n=document.getElementById("message");fetch(`${root_url}/api/login`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}).then((e=>e.json())).then((e=>{e.success?(n.style.color="green",n.textContent="Login successful!",setTimeout((function(){var e=getQueryParam("redirect");window.location.href="files"===e?"/files.html":"blog"===e?"/blog.html":"/files.html"}),300)):n.textContent=e.message||"Login failed"})).catch((e=>{console.error("Error:",e),n.textContent="An error occurred. Please try again."}))}window.onload=function(){var e=document.getElementById("loginForm"),t=document.querySelector(".guest-access"),n=document.getElementById("loginMessage"),o=document.getElementById("guestMessage");"blog"===getQueryParam("redirect")&&(t&&(t.style.display="none"),o&&(o.style.display="none"),n&&(n.textContent="You need to log in to manage blog posts")),e&&(e.onsubmit=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,handleLogin()})};
