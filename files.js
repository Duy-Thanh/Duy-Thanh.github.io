function checkAuthStatus(e){var t=new XMLHttpRequest;t.open("GET",root_url+"/api/check-auth?t="+(new Date).getTime(),!0),t.withCredentials=!0,t.onreadystatechange=function(){if(4===t.readyState)if(200===t.status){var a=JSON.parse(t.responseText),n=document.getElementById("userStatus"),i=document.getElementById("uploadSection");if(!0===a.isAuthenticated)n.textContent="Administrator",i&&(i.style.display="block"),e&&e();else if(!0===a.isGuest)n.textContent="Guest User",i&&(i.style.display="none"),e&&e();else{var o=document.getElementById("authModal");o&&(o.style.display="flex")}}else{var l=document.getElementById("fileList");l&&(l.innerHTML='<div class="loading">Error checking access. Please try again.</div>')}},t.send()}function continueAsGuest(){var e=new XMLHttpRequest;e.open("POST",root_url+"/api/guest",!0),e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&location.reload()},e.send(JSON.stringify({}))}function loadFiles(){var e=new XMLHttpRequest;e.open("GET",root_url+"/api/files",!0),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&displayFiles(JSON.parse(e.responseText))},e.send()}function displayFiles(e){var t=document.getElementById("fileList");t&&(t.innerHTML="",(e=e.filter((function(e){return 0!==e.name.indexOf("blog_media_")}))).forEach((function(e){var a=document.createElement("div");a.className="file-item";var n=getFileIconClass(e.name.split(".").pop().toLowerCase()),i=document.createElement("div");i.className="file-info";var o=document.createElement("i");o.className="fas "+n+" file-icon",i.appendChild(o);var l=document.createElement("div");l.className="file-details";var r=document.createElement("div");r.className="file-name",r.textContent=e.name,l.appendChild(r);var s=document.createElement("div");s.className="file-meta",s.innerHTML="Size: "+formatFileSize(e.size)+"<br>Uploaded: "+formatDateTime(e.created)+"<br>Modified: "+formatDateTime(e.modified),l.appendChild(s),i.appendChild(l),a.appendChild(i);var d=document.createElement("div");d.className="file-actions";var f=document.createElement("button");f.className="action-btn download-btn",f.onclick=function(){downloadFile(e.name)};var c=document.createElement("i");if(c.className="fas fa-download",f.appendChild(c),d.appendChild(f),window.isAdmin){var u=document.createElement("button");u.className="action-btn delete-btn",u.onclick=function(){deleteFile(e.name)};var m=document.createElement("i");m.className="fas fa-trash",u.appendChild(m),d.appendChild(u)}a.appendChild(d),t.appendChild(a)})))}function getFileIconClass(e){return{pdf:"fa-file-pdf",doc:"fa-file-word",docx:"fa-file-word",xls:"fa-file-excel",xlsx:"fa-file-excel",ppt:"fa-file-powerpoint",pptx:"fa-file-powerpoint",jpg:"fa-file-image",jpeg:"fa-file-image",png:"fa-file-image",gif:"fa-file-image",mp3:"fa-file-audio",wav:"fa-file-audio",mp4:"fa-file-video",mov:"fa-file-video",zip:"fa-file-archive",rar:"fa-file-archive",txt:"fa-file-alt",json:"fa-file-code",js:"fa-file-code",css:"fa-file-code",html:"fa-file-code"}[e]||"fa-file"}function formatFileSize(e){if(0===e)return"0 Bytes";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}function formatDateTime(e){if(!e)return"Unknown";var t=new Date(e);if(isNaN(t.getTime()))return"Unknown";var a=new Date,n=new Date(a);n.setDate(n.getDate()-1);var i=t.getHours(),o=t.getMinutes(),l=i>=12?"PM":"AM",r=(i=(i%=12)||12)+":"+(o=o<10?"0"+o:o)+" "+l;if(t.toDateString()===a.toDateString())return"Today at "+r;if(t.toDateString()===n.toDateString())return"Yesterday at "+r;return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]+" "+t.getDate()+(t.getFullYear()!==a.getFullYear()?", "+t.getFullYear():"")+" at "+r}function downloadFile(e){window.location.href=root_url+"/api/files/download/"+e}function logout(){var e=new XMLHttpRequest;e.open("POST",root_url+"/api/logout",!0),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&(window.location.href="/")},e.send()}function deleteFile(e){var t=new XMLHttpRequest;t.open("DELETE",root_url+"/api/files/"+e,!0),t.onload=function(){200===t.status?location.reload():alert("Delete failed: "+t.statusText)},t.onerror=function(){alert("Delete failed: Network Error")},t.send()}window.onload=function(){var e=document.getElementById("fileList");e&&(e.innerHTML='<div class="loading">Checking access...</div>'),setTimeout((function(){checkAuthStatus((function(){loadFiles()}))}),300)},document.getElementById("uploadForm")&&(document.getElementById("uploadForm").onsubmit=function(e){e.preventDefault();var t=new FormData,a=document.querySelector('input[type="file"]');if(a.files[0]){t.append("file",a.files[0]);var n=new XMLHttpRequest;n.open("POST",root_url+"/api/files/upload",!0),n.onload=function(){200===n.status?location.reload():(console.error("Error:",n.statusText),alert("Upload failed: "+n.statusText))},n.onerror=function(){console.error("Error:",n.statusText),alert("Upload failed: Network Error")},n.send(t)}else alert("Please select a file first")},document.getElementById("fileInput").onchange=function(){var e=this.files[0]?this.files[0].name:"No file chosen";document.querySelector(".file-name-display").textContent=e});
